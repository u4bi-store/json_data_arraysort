<?php
// @myungjae_yu
	/*
			@ 윤희동
			@ 2016-10-04 작성
			@ 변수명 규칙




	0. total_array 규칙
	  ex) $t_array  = array($fg_t_array,$pc_t_array,$ps_t_array,$sr_t_array,$cm_t_array)  순서는 fg,pc,ps,sr,cm



	1. array 규칙 (영역)_(항목)_array
  	  ex) $fg_t_array    시간 값, array(0.55,4.04,...) 이런식으로 넣어 주세요.  단위는 소수점 3째짜리까지
	  ex) $fg_r_array    정답 유무, array(0,1,1,1,0...) 이런식으로 넣어 주세요.  0: 오답. 1: 정답


	2. 규칙 (영역)_(항목)_(문제 번호)
	  ex) $fg_r_1    fg 영역의 2번째 문제의 정답 유무, 시작수를 0부터



	3. 평균 규칙   (규모)_(영역)_(문제번호)_(항목)_(통계구분) 규모에 따라 구분가능하면 삭제함
	  ex) $total_t_stdev    모든 문항의 시간에 대한 표준편차
	  ex) $total_r_aver     모든 문항의 정답률에 대한 평균
	  ex) $fg_t_aver    fg 문항의 시간에 대한 평균
	  ex) $fg_1_t_aver    fg 문항의 2번째 문제의 시간에 대한 평균
	  ex) $fg_15_t_stdev    fg 문항의 16번째 문제의 시간에 대한 표준 편차


	4.temp_(함수) 는 평균을 도출하기 위한 임시 함수
		지워서 드림
	*/
    // 측정항목 분석 - 정보 처리 속도


	function Speed($t_array,$r_array){
		$check_t = 0;
		$check_r = 0;
		for($i = 0 ; $i < count($t_array);$i++ ){
			$temp_t_array = $t_array[$i];
			$temp_r_array = $r_array[$i];
			for($j = 0 ; $j < count($temp_t_array);$j++ ){
                if(!is_null($temp_r_array[$j])){
                    $check_t +=	$temp_t_array[$j]/1000;
                    $check_r += $temp_r_array[$j];
                }
			}

		}
		$want = $check_t / $check_r;
		return $want;
    }


	//나이 변환 함수
	function trans_age($age){
		if($age<=7){$want =0;}
		elseif($age<=8){$want =1;}
		elseif($age<=9){$want =2;}
		elseif($age<=11){$want =3;}
		else{$want =4;}
		return $want;
	}


	$total_aver   = array(13.25177776, 9.892663059,9.468047574,8.587365995,6.779518092);   //나이별로 총 풀이 시간에 대한 평균
	$total_stdev  = array(3.634074956, 2.008628356,2.392136746,2.665690547,1.047356891);   //나이별로 총 풀이 시간에 대한 표준편차


	function T_Speed($t_array,$r_array,$age,$total_aver,$total_stdev){
		$t_age = trans_age($age);
		$check_t = 0;
		$check_r = 0;
		for($i = 0 ; $i < count($t_array);$i++ ){
			$temp_t_array = $t_array[$i];
			$temp_r_array = $r_array[$i];
			for($j = 0 ; $j < count($temp_t_array);$j++ ){
				$check_t +=	$temp_t_array[$j]/1000 ;
				$check_r += $temp_r_array[$j] ;
			}
		}
		$want = ($total_aver[$t_age]-$check_t/$check_r)/$total_stdev[$t_age]*20+100;
		return $want;
	}



	//아동 수준


	// 아동의 수준
	// $velocity = Speed($t_array,$r_array,$age,$total_aver,$total_stdev)

    function Speed_level($velocity,$velocity_level_stard,$age){
		$t_age = trans_age($age);
		if( $velocity < 	$velocity_level_stard[0][$t_age]){$want = '매우 빠름';}
		elseif( $velocity < $velocity_level_stard[1][$t_age]){$want = '빠름';}
		elseif( $velocity < $velocity_level_stard[2][$t_age]){$want = '보통';}
		elseif( $velocity < $velocity_level_stard[3][$t_age]){$want = '느림';}
		else{$want = '매우 느림';}
		return $want;
    }



	// 정확도
	function temp_Accuracy($r_array){
		$check_r = 0;
		for($i = 0 ; $i < count($r_array);$i++ ){
			$temp_r_array = $r_array[$i];
			for($j = 0 ; $j < count($temp_r_array);$j++ ){
				$check_r += $temp_r_array[$j] ;
			}

		}
		$want = $check_r;
		return $want;
	}

	function Accuracy($r_array){
		$check_r = 0;
		for($i = 0 ; $i < count($r_array);$i++ ){
			$temp_r_array = $r_array[$i];
			for($j = 0 ; $j < count($temp_r_array);$j++ ){
				$check_r += $temp_r_array[$j] ;
			}

		}
		$want = $check_r/80*100;
		return $want;
	}


	//$total_ratio = 모든 영역의 정답수/80*100
    function Accuracy_level($total_ratio,$ratio_level_stard,$age){
		$t_age = trans_age($age);

		if( $total_ratio > 	$ratio_level_stard[0][$t_age]){$want1 = '매우 높음';$want2 = '매우 적습니다.';$want3 = 0 ;}
		elseif( $total_ratio > $ratio_level_stard[1][$t_age]){$want1 = '평균';$want2 = '적습니다.';$want3 = 1 ;}
		elseif( $total_ratio > $ratio_level_stard[2][$t_age]){$want1 = '낮음';$want2 = '많습니다.';$want3 = 2 ;}
		else{$want1 = '매우 낮음'; $want2 = '매우 많습니다.';$want3 = 3 ;}
		$want = array($want1,$want2,$want3);
		return $want;
    }








    // 아동들의 평균수준
    function area_t_score($value,$array_total_stats,$age){
		$t_age = trans_age($age);
		$gp_age =$array_total_stats[$t_age];
		$want_0 = ($value[0]-$gp_age[0][0])/$gp_age[0][1]*20+100;
		$want_1 = ($value[1]-$gp_age[1][0])/$gp_age[1][1]*20+100;
		$want_2 = ($value[2]-$gp_age[2][0])/$gp_age[2][1]*20+100;
		$want_3 = ($value[3]-$gp_age[3][0])/$gp_age[3][1]*20+100;
		$want_4 = ($value[4]-$gp_age[4][0])/$gp_age[4][1]*20+100;
		$want = array($want_0,$want_1,$want_2,$want_3,$want_4) ;
		return $want;
    }


    // 개별문제 높고 낮음 판단 함수
    function each_pro($value,$mean,$stdev){
		if($value < $mean-$stdev/2){$want = '빠름';}
		elseif($value < $mean+$stdev/2){$want = '보통';}
		else{$want = '느림';}
		return $want;
    }


/////////////////////////////////////추가 - 2016-10-07

/* TODO : 할거 정리
 *
 * TODO : 전체 레벨 데이터 가공
	 *
		$value_0 = Speed_level($velocity,$velocity_level_stard,$age)
		$value_1 = Accuracy_level($total_ratio,$ratio_level_stard,$age)[2],
	    function total_level($value_0,$value_1);

	    // 처리완료
	     *
 	TODO : 정확도 범위
	 *
	 	ratio_range($velocity_level_stard,$age)

	 		return arrat(0,1,2)  A B C

	 		// 처리완료

	TODO : 그래프 속도
	 *
	  	$value = T_Speed($t_array,$r_array,$age,$total_aver,$total_stdev)
	  	function velocity_line($value);

 * */

	 // 그래프 속도 $value = T_Speed($t_array,$r_array,$age,$total_aver,$total_stdev)
    function velocity_line($value){
		if($value >= 150){
			$want = 20-$value/10;
		}
		elseif($value >=50){
			$want = 175 - 17/10*($value-50);
		}

		else{
			$want = 180 - $value/10;
		}
		$line_want = array(
				array(42,190.,0,190.),
				array(42.0240641652902,187.380393793764,0.0304609687217408,186.684042776916),
				array(42.0962493309829,184.761585544955,0.121834596180861,183.369095626525),
				array(42.2165335087773,182.144372967934,0.274093049085224,180.056168313841),
				array(42.3848800589478,179.529553291007,0.487189948035166,176.746269988616),
				array(42.6012377015042,176.917923013577,0.761060381650879,173.440408877945),
				array(42.8655405318128,174.310277663525,1.09562092634533,170.139591979146),
				array(43.1777080406711,171.707411554887,1.49076967173559,166.844824753022),
				array(43.5376451388319,169.110117545894,1.94638625168594,163.557110817588),
				array(43.9452421859682,166.519186797461,2.46233188097244,160.277451642356),
				array(44.4003750240711,163.935408532194,3.03844939755837,157.006846243283),
				array(44.9029050152691,161.359569793981,3.67456331046719,153.746290878457),
				array(45.4526790840587,158.792455208254,4.37047985323886,150.496778744626),
				array(46.0495297639328,156.234846742986,5.12598704295294,147.259299674666),
				array(46.6932752483926,153.68752347049,5.9408547448007,144.034839836063),
				array(47.3837194463272,151.151261330112,6.81483474218635,140.824381430521),
				array(48.1206520417456,148.626832891868,7.74766081233622,137.62890239477),
				array(48.9038485578404,146.115007121117,8.73904880739292,134.44937610268),
				array(49.7330704253657,143.61654914432,9.78869674096927,131.28677106876),
				array(50.6080650553079,141.132220015981,10.8962848801366,128.14205065314),
				array(51.5285659158265,138.662776486817,12.0614758428183,125.016172768123),
				array(52.4942926134421,136.20897077325,13.2839147005596,121.910089586393),
				array(53.5049509784476,133.771550328272,14.5632290866425,118.824747250977),
				array(54.5602331545144,131.35125761376,15.8990293095119,115.761085587038),
				array(55.6598176924691,128.948829874322,17.2909084714798,112.720037815598),
				array(56.8033696482093,126.564998912721,18.73844259267,109.702530269267),
				array(57.9905406847316,124.200490866959,20.2411907401666,106.709482110075),
				array(59.2209691782379,121.856025989094,21.7986951623264,103.741805049486),
				array(60.4942803282895,119.532318425838,23.4104814282146,100.800403070681),
				array(61.8100862719755,117.230076001025,25.0760585721208,97.886172153196),
				array(63.1679862020587,114.95,26.7949192431122,95.0000000000001),
				array(64.5675664890663,112.692784956001,28.5665398595775,92.1427657670897),
				array(66.0084008072847,110.459118438596,30.3903807687148,89.3153397956911),
				array(67.490050264623,108.249680844245,32.2658864109152,86.5185833471449),
				array(69.0120635363034,106.065145189041,34.1924854889916,83.7533483405581),
				array(70.5739770023393,103.906176903708,36.1695911422017,81.0204770933012),
				array(72.1753148887583,101.7734336309,38.1966011250105,78.3208020644301),
				array(73.8155894125277,99.6675650248776,40.2728979905414,75.6551456011109),
				array(75.4943009301379,97.5892125536187,42.3978492786556,73.024319688125),
				array(77.2109380897986,95.5390093034194,44.5708077086059,70.4291257005309),
				array(78.9649779872015,93.5175797860505,46.7911113762044,67.8703541595575),
				array(80.755886324802,91.5255397485249,49.0580839554456,65.3487844918037),
				array(82.5831175745717,89.5634959855354,51.3710349045211,62.8651847918169),
				array(84.4461151441711,87.632046154619,53.7292596761659,60.4203115881253),
				array(86.3443115464931,85.7317785941045,56.1320399322698,58.0149096127905),
				array(88.2771285725255,83.8632721438992,58.5786437626905,55.649711574556),
				array(90.2439774674784,82.0270959691685,61.0683259082005,53.3254379356563),
				array(92.2442591101252,80.2238093869625,63.6003279875003,51.0427966923576),
				array(94.2773641953004,78.4539616958432,66.1738787282283,48.8024831592952),
				array(96.3426734194999,76.7180920085619,68.7881942018985,46.6051797576733),
				array(98.4395576695268,75.0167290878414,71.4424780626921,44.4515558073942),
				array(100.567378214126,73.3503911853087,74.1359217900324,42.3422673231756),
				array(102.725486898546,71.719585883631,76.8677049348684,40.2779568147228),
				array(104.913226341976,70.1248099419014,79.6369953695904,38.2592530910144),
				array(107.129930137789,68.5665491443204,82.4429495415054,36.28677106876),
				array(109.374923056535,67.0452781522224,85.2847127297907,34.3611115850916),
				array(111.647521251622,65.5614603594883,88.1614193058506,32.4828612145421),
				array(113.947032467626,64.1155477513919,91.0721929969946,30.6525920903694),
				array(116.272756251154,62.7079807669205,94.016147153359,28.8708617302791),
				array(118.623984164211,61.339188164613,96.9923850179891,27.1382128665987),
				array(121.,60.0095868919558,99.9999999999999,25.4551732809567),
				array(123.400080001079,58.7195819583768,103.038075950732,23.8222556435149),
				array(125.823493079829,57.4695663118751,106.105687442822,22.2399573568039),
				array(128.269501041152,56.259920719326,109.201900052091,20.7087604042101),
				array(130.737358807326,55.0910136504951,112.325770642184,19.2291312031583),
				array(133.22631464497,53.9632011657988,115.47634765186,17.8015204630365),
				array(135.735610394023,52.8768268078457,118.65267138484,16.4263630479059),
				array(138.264481698695,51.8322214967887,121.853774302145,15.1040778440363),
				array(140.812158240286,50.8297034295252,125.078681316818,13.8350676323104),
				array(143.377863971843,49.86957798277,128.32641009094,12.6197189655317),
				array(145.960817354544,48.9521376200352,131.595971334866,11.4584020506774),
				array(148.560231595769,48.0776618025425,134.886369108569,10.3514706361298),
				array(151.175314888758,47.2464169040975,138.196601125011,9.29926190392084),
				array(153.805270653808,46.4586561299484,141.525659055453,8.3020963670233),
				array(156.449297780914,45.7146194396584,144.8725288366,7.36027777171944),
				array(159.106590873802,45.0145334740109,148.236190979496,6.47409300507701),
				array(161.776340495253,44.3586114859729,151.615620880066,5.64381200756068),
				array(164.457733413669,43.7470532757362,155.009789131227,4.86968769080534),
				array(167.149952850794,43.1800451298558,158.417661836448,4.15195586057692),
				array(169.852178730506,42.6577597645057,161.838200924691,3.49083514494387),
				array(172.563587928625,42.1803562728676,165.270364466614,2.88652692768048),
				array(175.283354523643,41.7479800766699,168.713106991954,2.33921528692383),
				array(178.01065004831,41.3607628818903,172.165379807987,1.84906693910165),
				array(180.744643741987,41.0188226386376,175.626131318971,1.4162311881488),
				array(183.484502803711,40.7222635052222,179.094307346469,1.04083988002805),
				array(186.22939264587,40.471175816429,182.568851450468,0.723007362568353),
				array(188.978477148428,40.2656360560004,186.048705251175,0.46283045063339),
				array(191.730918913615,40.1057068333385,189.532808751411,0.260388396630958),
				array(194.485879521005,39.9914368644337,193.0201006595,0.115742866371818),
				array(197.242519782909,39.9228609570257,196.509518712543,0.0289379202856708),
				array(200.,39.9,200.,0),
				array(202.757480217091,39.9228609570257,203.490481287457,0.0289379202856708),
				array(205.514120478995,39.9914368644337,206.9798993405,0.115742866371818),
				array(208.269081086385,40.1057068333385,210.467191248589,0.260388396630958),
				array(211.021522851572,40.2656360560004,213.951294748825,0.46283045063339),
				array(213.77060735413,40.471175816429,217.431148549532,0.723007362568353),
				array(216.515497196289,40.7222635052222,220.905692653531,1.04083988002805),
				array(219.255356258013,41.0188226386376,224.373868681029,1.4162311881488),
				array(221.98934995169,41.3607628818903,227.834620192013,1.84906693910162),
				array(224.716645476356,41.7479800766698,231.286893008046,2.33921528692383),
				array(227.436412071375,42.1803562728676,234.729635533386,2.88652692768045),
				array(230.147821269494,42.6577597645057,238.161799075309,3.49083514494387),
				array(232.850047149206,43.1800451298558,241.582338163552,4.15195586057689),
				array(235.542266586331,43.7470532757362,244.990210868773,4.86968769080531),
				array(238.223659504747,44.3586114859729,248.384379119934,5.64381200756066),
				array(240.893409126198,45.0145334740109,251.763809020504,6.47409300507701),
				array(243.550702219086,45.7146194396584,255.1274711634,7.36027777171944),
				array(246.194729346192,46.4586561299484,258.474340944547,8.30209636702327),
				array(248.824685111242,47.2464169040974,261.803398874989,9.29926190392081),
				array(251.439768404231,48.0776618025425,265.113630891431,10.3514706361298),
				array(254.039182645456,48.9521376200351,268.404028665134,11.4584020506774),
				array(256.622136028157,49.86957798277,271.67358990906,12.6197189655317),
				array(259.187841759714,50.8297034295252,274.921318683182,13.8350676323104),
				array(261.735518301305,51.8322214967887,278.146225697855,15.1040778440363),
				array(264.264389605976,52.8768268078456,281.34732861516,16.4263630479058),
				array(266.77368535503,53.9632011657988,284.52365234814,17.8015204630364),
				array(269.262641192674,55.091013650495,287.674229357816,19.2291312031583),
				array(271.730498958848,56.259920719326,290.798099947909,20.7087604042101),
				array(274.176506920171,57.469566311875,293.894312557178,22.2399573568038),
				array(276.599919998921,58.7195819583767,296.961924049267,23.8222556435148),
				array(279.,60.0095868919557,300.,25.4551732809566),
				array(281.376015835789,61.339188164613,303.007614982011,27.1382128665987),
				array(283.727243748846,62.7079807669204,305.983852846641,28.870861730279),
				array(286.052967532374,64.1155477513918,308.927807003005,30.6525920903694),
				array(288.352478748378,65.5614603594883,311.838580694149,32.4828612145421),
				array(290.625076943465,67.0452781522223,314.715287270209,34.3611115850915),
				array(292.870069862211,68.5665491443204,317.557050458495,36.28677106876),
				array(295.086773658024,70.1248099419014,320.36300463041,38.2592530910144),
				array(297.274513101454,71.719585883631,323.132295065132,40.2779568147228),
				array(299.432621785874,73.3503911853087,325.864078209968,42.3422673231756),
				array(301.560442330473,75.0167290878414,328.557521937308,44.4515558073942),
				array(303.6573265805,76.7180920085619,331.211805798101,46.6051797576733),
				array(305.7226358047,78.4539616958431,333.826121271772,48.802483159295),
				array(307.755740889875,80.2238093869624,336.3996720125,51.0427966923575),
				array(309.756022532522,82.0270959691685,338.931674091799,53.3254379356563),
				array(311.722871427475,83.8632721438992,341.42135623731,55.6497115745559),
				array(313.655688453507,85.7317785941045,343.86796006773,58.0149096127905),
				array(315.553884855829,87.632046154619,346.270740323834,60.4203115881253),
				array(317.416882425428,89.5634959855354,348.628965095479,62.865184791817),
				array(319.244113675198,91.5255397485249,350.941916044554,65.3487844918036),
				array(321.035022012799,93.5175797860504,353.208888623796,67.8703541595575),
				array(322.789061910201,95.5390093034194,355.429192291394,70.4291257005308),
				array(324.505699069862,97.5892125536187,357.602150721344,73.024319688125),
				array(326.184410587472,99.6675650248775,359.727102009458,75.6551456011107),
				array(327.824685111242,101.7734336309,361.803398874989,78.3208020644301),
				array(329.426022997661,103.906176903708,363.830408857798,81.0204770933013),
				array(330.987936463697,106.065145189041,365.807514511008,83.753348340558),
				array(332.509949735377,108.249680844244,367.734113589085,86.5185833471449),
				array(333.991599192715,110.459118438596,369.609619231285,89.3153397956911),
				array(335.432433510934,112.692784956001,371.433460140422,92.1427657670896),
				array(336.832013797941,114.95,373.205080756888,95.0000000000001),
				array(338.189913728024,117.230076001025,374.923941427879,97.8861721531958),
				array(339.50571967171,119.532318425838,376.589518571785,100.800403070681),
				array(340.779030821762,121.856025989094,378.201304837674,103.741805049486),
				array(342.009459315268,124.200490866959,379.758809259833,106.709482110075),
				array(343.196630351791,126.564998912721,381.26155740733,109.702530269267),
				array(344.340182307531,128.948829874322,382.70909152852,112.720037815598),
				array(345.439766845486,131.35125761376,384.100970690488,115.761085587038),
				array(346.495049021552,133.771550328272,385.436770913357,118.824747250977),
				array(347.505707386558,136.20897077325,386.71608529944,121.910089586393),
				array(348.471434084174,138.662776486817,387.938524157182,125.016172768123),
				array(349.391934944692,141.132220015981,389.103715119863,128.14205065314),
				array(350.266929574634,143.61654914432,390.211303259031,131.28677106876),
				array(351.09615144216,146.115007121117,391.260951192607,134.44937610268),
				array(351.879347958254,148.626832891868,392.252339187664,137.62890239477),
				array(352.616280553673,151.151261330112,393.185165257814,140.824381430521),
				array(353.306724751608,153.68752347049,394.059145255199,144.034839836063),
				array(353.950470236067,156.234846742986,394.874012957047,147.259299674666),
				array(354.547320915941,158.792455208254,395.629520146761,150.496778744626),
				array(355.097094984731,161.359569793981,396.325436689533,153.746290878456),
				array(355.599624975929,163.935408532194,396.961550602442,157.006846243283),
				array(356.054757814032,166.519186797461,397.537668119028,160.277451642356),
				array(356.462354861168,169.110117545894,398.053613748314,163.557110817587),
				array(356.822291959329,171.707411554887,398.509230328264,166.844824753022),
				array(357.134459468187,174.310277663525,398.904379073655,170.139591979146),
				array(357.398762298496,176.917923013576,399.238939618349,173.440408877945),
				array(357.615119941052,179.529553291007,399.512810051965,176.746269988616),
				array(357.783466491223,182.144372967934,399.725906950915,180.056168313841),
				array(357.903750669017,184.761585544955,399.878165403819,183.369095626525),
				array(357.97593583471,187.380393793764,399.969539031278,186.684042776916),
				array(358,190,400,190));

		$last_want = $line_want[$want];
		return $last_want;
    }

	 // 전체 레벨
	 //$value_0 = Speed_level($velocity,$velocity_level_stard,$age)
	 //$value_1 = Accuracy_level($total_ratio,$ratio_level_stard,$age)[2],
    function total_level($value_0,$value_1){
		if($value_0 == '매우 빠름'){
			if($value_1 == 0){$want = 'A';}
			elseif($value_1 == 1){$want = 'A';}
			elseif($value_1 == 2){$want = 'B';}
			elseif($value_1 == 3){$want = 'C';}
		}
		elseif($value_0 == '빠름'){
			if($value_1 == 0){$want = 'A';}
			elseif($value_1 == 1){$want = 'A';}
			elseif($value_1 == 2){$want = 'B';}
			elseif($value_1 == 3){$want = 'C';}
		}
		elseif($value_0 == '보통'){
			if($value_1 == 0){$want = 'A';}
			elseif($value_1 == 1){$want = 'B';}
			elseif($value_1 == 2){$want = 'B';}
			elseif($value_1 == 3){$want = 'C';}
		}
		elseif($value_0 == '느림'){
			if($value_1 == 0){$want = 'B';}
			elseif($value_1 == 1){$want = 'B';}
			elseif($value_1 == 2){$want = 'C';}
			elseif($value_1 == 3){$want = 'C';}

		}
		elseif($value_0 == '매우 느림'){
			if($value_1 == 0){$want = 'B';}
			elseif($value_1 == 1){$want = 'B';}
			elseif($value_1 == 2){$want = 'C';}
			elseif($value_1 == 3){$want = 'C';}
		}
		else{
			$want = 'unknown';
		}
		return $want;
	}

	 // 정확도 범위
 	 //$velocity_level_stard나이별 정확도 기준

    function ratio_range($velocity_level_stard,$age){
		$t_age = trans_age($age);
		$want_0 = $ratio_level_stard[0][$t_age];
		$want_1 = $ratio_level_stard[1][$t_age];
		$want_2 = $ratio_level_stard[2][$t_age];
		$want = array($want_0,$want_1,$want_2);
		return $want;
    }


?>